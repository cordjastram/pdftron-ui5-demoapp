sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/m/MessageBox","sap/m/MessageToast"],function(e,t,i,o,a,l,s){"use strict";return e.extend("com.cjastram.PDFEditor.controller.Worklist",{onInit:function(){var e,i,o,a=this.byId("table");o=a.getBusyIndicatorDelay();this._aTableSearchState=[];e=new t({worklistTableTitle:this.getResourceBundle().getText("worklistTableTitle"),shareOnJamTitle:this.getResourceBundle().getText("worklistTitle"),tableNoDataText:this.getResourceBundle().getText("tableNoDataText"),tableBusyDelay:0});this.setModel(e,"worklistView");this.setModel(i,"upload");a.attachEventOnce("updateFinished",function(){e.setProperty("/tableBusyDelay",o)})},onUpdateFinished:function(e){var t,i=e.getSource(),o=e.getParameter("total");if(o&&i.getBinding("items").isLengthFinal()){t=this.getResourceBundle().getText("worklistTableTitleCount",[o])}else{t=this.getResourceBundle().getText("worklistTableTitle")}this.getModel("worklistView").setProperty("/worklistTableTitle",t)},onPress:function(e){this._showObject(e.getSource())},uploadFile:function(){this.byId("fileUploaderId").upload()},showUploadDialog:function(e){var i=new t;if(!this._uploadFileDialog){a.load({id:this.getView().getId(),name:"com.cjastram.PDFEditor.view.FileUploadDialog",controller:this}).then(function(e){this._uploadFileDialog=e;this.getView().addDependent(this._uploadFileDialog);this._uploadFileDialog.setModel(i);this._uploadFileDialog.open()}.bind(this))}else{this._uploadFileDialog.open()}},closeUploadDialog:function(e){this._uploadFileDialog.close()},fileUploadComplete:function(e){var t=this._uploadFileDialog.getModel();var i=this.getView().byId("fileUploaderId");var o=i.getFocusDomRef().files[0];var a=new FileReader;var l=t.getProperty("/Description");a.onload=function(e){var t="data:"+o.type+";base64,";var i=e.currentTarget.result.replace(t,"");var a={Id:"00000000-0000-0000-0000-000000000000",Description:l,FileName:o.name,Data:i};var n=function(e){s.show("Document uploaded!");this._uploadFileDialog.close()}.bind(this);var r=function(e){s.show("Document upload failed!");this._uploadFileDialog.close()}.bind(this);this._createPdfFile(a,n,r)}.bind(this);a.readAsDataURL(o)},_createPdfFile:function(e,t,i){this.getModel().create("/PdfFiles",e,{success:function(e){t(e)}.bind(this),error:function(e){i(e)}})},onNavBack:function(){history.go(-1)},onSearch:function(e){if(e.getParameters().refreshButtonPressed){this.onRefresh()}else{var t=[];var a=e.getParameter("query");if(a&&a.length>0){t=[new i("FileName",o.Contains,a)]}this._applySearch(t)}},onRefresh:function(){var e=this.byId("table");e.getBinding("items").refresh()},deleteFile:function(e){var t=this.getModel().createKey("/PdfFiles",{Id:e.getSource().data("Id")});l.warning("Press OK to delete file!",{actions:[l.Action.OK,l.Action.CANCEL],emphasizedAction:l.Action.OK,onClose:function(e){if(e==="OK"){this.getModel().remove(t,{method:"DELETE",success:function(e){s.show("Document deleted!")},error:function(){s.show("Document could not be deleted!")}})}}.bind(this)})},_showObject:function(e){this.getRouter().navTo("object",{objectId:e.getBindingContext().getProperty("Id")})},_applySearch:function(e){var t=this.byId("table"),i=this.getModel("worklistView");t.getBinding("items").filter(e,"Application");if(e.length!==0){i.setProperty("/tableNoDataText",this.getResourceBundle().getText("worklistNoDataWithSearchText"))}}})});